<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <title>HTML Form Example</title>
  </head>

  <body>
    <main>
      <section class="flex min-h-screen">
        <form class="m-auto flex w-1/3 flex-col gap-2 rounded border p-4" novalidate>
          <div class="flex flex-col gap-2">
            <div class="flex flex-col-reverse gap-2">
              <input
                class="peer rounded p-2 outline-none outline-1 valid:border invalid:outline invalid:outline-red-600"
                id="admin"
                label="Admin"
                name="admin"
                type="checkbox"
              />
              <label
                class="text-sm after:text-red-500 peer-invalid:text-red-500 peer-data-[validation-required=true]:after:content-['*']"
                for="admin"
                >Admin</label
              >
            </div>
            <div class="flex flex-col gap-2"></div>
          </div>
          <div class="flex flex-col gap-2">
            <div class="flex flex-col-reverse gap-2">
              <input
                class="peer rounded p-2 outline-none outline-1 valid:border invalid:outline invalid:outline-red-600"
                id="givenName"
                label="Given Name"
                name="givenName"
              />
              <label
                class="text-sm after:text-red-500 peer-invalid:text-red-500 peer-data-[validation-required=true]:after:content-['*']"
                for="givenName"
                >Given Name</label
              >
            </div>
            <div class="flex flex-col gap-2"></div>
          </div>
          <div class="flex flex-col gap-2">
            <div class="flex flex-col-reverse gap-2">
              <input
                class="peer rounded p-2 outline-none outline-1 valid:border invalid:outline invalid:outline-red-600"
                id="surname"
                label="Surname"
                name="surname"
              />
              <label
                class="text-sm after:text-red-500 peer-invalid:text-red-500 peer-data-[validation-required=true]:after:content-['*']"
                for="surname"
                >Surname</label
              >
            </div>
            <div class="flex flex-col gap-2"></div>
          </div>
          <div class="flex flex-col gap-2">
            <div class="flex flex-col-reverse gap-2">
              <input
                class="peer rounded p-2 outline-none outline-1 valid:border invalid:outline invalid:outline-red-600"
                id="birthday"
                label="Birthday"
                name="birthday"
                type="date"
              />
              <label
                class="text-sm after:text-red-500 peer-invalid:text-red-500 peer-data-[validation-required=true]:after:content-['*']"
                for="birthday"
                >Birthday</label
              >
            </div>
            <div class="flex flex-col gap-2"></div>
          </div>
          <div class="flex flex-col gap-2">
            <div class="flex flex-col-reverse gap-2">
              <input
                class="peer rounded p-2 outline-none outline-1 valid:border invalid:outline invalid:outline-red-600"
                id="amount"
                label="Amount"
                name="amount"
                type="number"
              />
              <label
                class="text-sm after:text-red-500 peer-invalid:text-red-500 peer-data-[validation-required=true]:after:content-['*']"
                for="amount"
                >Amount</label
              >
            </div>
            <div class="flex flex-col gap-2"></div>
          </div>
          <div class="flex flex-col gap-2">
            <div class="flex flex-col-reverse gap-2">
              <input
                class="peer rounded p-2 outline-none outline-1 valid:border invalid:outline invalid:outline-red-600"
                id="range"
                label="Range"
                name="range"
                type="range"
                min="0"
                max="100"
                step="1"
              />
              <label
                class="text-sm after:text-red-500 peer-invalid:text-red-500 peer-data-[validation-required=true]:after:content-['*']"
                for="range"
                >Range</label
              >
            </div>
            <div class="flex flex-col gap-2"></div>
          </div>
          <div class="flex flex-col rounded border p-2">
            <div class="flex flex-col gap-2">
              <div class="flex flex-col-reverse gap-2">
                <input
                  class="peer rounded p-2 outline-none outline-1 valid:border invalid:outline invalid:outline-red-600"
                  id="contact.tel"
                  label="Telephone"
                  name="contact.tel"
                />
                <label
                  class="text-sm after:text-red-500 peer-invalid:text-red-500 peer-data-[validation-required=true]:after:content-['*']"
                  for="contact.tel"
                  >Telephone</label
                >
              </div>
              <div class="flex flex-col gap-2"></div>
            </div>
            <div class="flex flex-col gap-2">
              <div class="flex flex-col-reverse gap-2">
                <input
                  class="peer rounded p-2 outline-none outline-1 valid:border invalid:outline invalid:outline-red-600"
                  id="contact.email.email"
                  label="E-Mail"
                  name="contact.email.email"
                />
                <label
                  class="text-sm after:text-red-500 peer-invalid:text-red-500 peer-data-[validation-required=true]:after:content-['*']"
                  for="contact.email.email"
                  >E-Mail</label
                >
              </div>
              <div class="flex flex-col gap-2"></div>
            </div>
            <div class="flex flex-col gap-2">
              <div class="flex flex-col-reverse gap-2">
                <input
                  class="peer rounded p-2 outline-none outline-1 valid:border invalid:outline invalid:outline-red-600"
                  id="contact.email.confirmEmail"
                  label="Confirm E-Mail"
                  name="contact.email.confirmEmail"
                />
                <label
                  class="text-sm after:text-red-500 peer-invalid:text-red-500 peer-data-[validation-required=true]:after:content-['*']"
                  for="contact.email.confirmEmail"
                  >Confirm E-Mail</label
                >
              </div>
              <div class="flex flex-col gap-2"></div>
            </div>
          </div>
          <div class="flex flex-col gap-2">
            <div class="flex flex-col-reverse gap-2">
              <select
                class="peer rounded p-2 outline-none outline-1 valid:border invalid:outline invalid:outline-red-600"
                id="pet"
                name="pet"
                label="Pet"
              >
                <option value="">--Please choose an option--</option>
                <option value="dog">Dog</option>
                <option value="cat">Cat</option>
                <option value="hamster">Hamster</option>
                <option value="parrot">Parrot</option>
                <option value="spider">Spider</option>
                <option value="goldfish">Goldfish</option>
              </select>
              <label
                class="text-sm after:text-red-500 peer-data-[validation-required=true]:after:content-['*']"
                for="pet"
                >Pet</label
              >
            </div>
          </div>
          <div class="flex flex-col gap-2">
            <div class="flex flex-col-reverse gap-2">
              <select
                class="peer rounded p-2 outline-none outline-1 valid:border invalid:outline invalid:outline-red-600"
                id="fruits"
                multiple=""
                name="fruits"
                label="Fruits"
              >
                <option value="apple">Apple</option>
                <option value="banana">Banana</option>
                <option value="kiwi">Kiwi</option>
              </select>
              <label
                class="text-sm after:text-red-500 peer-data-[validation-required=true]:after:content-['*']"
                for="fruits"
                >Fruits</label
              >
            </div>
          </div>
          <div class="flex flex-col gap-2">
            <div class="flex flex-col-reverse gap-2">
              <textarea
                class="peer rounded p-2 outline-none outline-1 valid:border invalid:outline invalid:outline-red-600"
                id="description"
                label="Description"
                name="description"
              ></textarea>
              <label
                class="text-sm after:text-red-500 peer-data-[validation-required=true]:after:content-['*']"
                for="description"
                >Description</label
              >
            </div>
            <div class="flex flex-col gap-2"></div>
          </div>
          <div class="flex flex-col-reverse gap-2">
            <fieldset
              name="monster"
              class="peer flex gap-2 rounded p-2 outline-none outline-1 data-[validation-error=false]:border data-[validation-error=true]:outline data-[validation-error=true]:outline-red-600"
            >
              <div class="flex flex-col gap-2">
                <div class="flex flex-col-reverse gap-2">
                  <input
                    class="peer rounded p-2 outline-none outline-1 valid:border invalid:outline invalid:outline-red-600"
                    id="monster"
                    label="Kraken"
                    name="monster"
                    type="radio"
                    value="kraken"
                  />
                  <label
                    class="text-sm after:text-red-500 peer-invalid:text-red-500 peer-data-[validation-required=true]:after:content-['*']"
                    for="monster"
                    >Kraken</label
                  >
                </div>
                <div class="flex flex-col gap-2"></div>
              </div>
              <div class="flex flex-col gap-2">
                <div class="flex flex-col-reverse gap-2">
                  <input
                    class="peer rounded p-2 outline-none outline-1 valid:border invalid:outline invalid:outline-red-600"
                    id="monster"
                    label="Sasquatch"
                    name="monster"
                    type="radio"
                    value="sasquatch"
                  />
                  <label
                    class="text-sm after:text-red-500 peer-invalid:text-red-500 peer-data-[validation-required=true]:after:content-['*']"
                    for="monster"
                    >Sasquatch</label
                  >
                </div>
                <div class="flex flex-col gap-2"></div>
              </div>
              <div class="flex flex-col gap-2">
                <div class="flex flex-col-reverse gap-2">
                  <input
                    class="peer rounded p-2 outline-none outline-1 valid:border invalid:outline invalid:outline-red-600"
                    id="monster"
                    label="Mothman"
                    name="monster"
                    type="radio"
                    value="mothman"
                  />
                  <label
                    class="text-sm after:text-red-500 peer-invalid:text-red-500 peer-data-[validation-required=true]:after:content-['*']"
                    for="monster"
                    >Mothman</label
                  >
                </div>
                <div class="flex flex-col gap-2"></div>
              </div>
            </fieldset>
            <label
              class="text-sm after:text-red-500 peer-data-[validation-required=true]:after:content-['*']"
              for="description"
              >Monster</label
            >
          </div>
          <div class="flex flex-col gap-2"></div>

          <button class="rounded border bg-slate-500 p-2">Save</button>
          <span class="text-sm text-gray-500">* required</span>
        </form>
      </section>
    </main>
  </body>

  <script type="importmap">
    {
      "imports": {
        "zod": "/node_modules/zod/lib/index.mjs",
        "@vardario/zod-form-validation": "/node_modules/@vardario/zod-form-validation/dist/browser.js"
      }
    }
  </script>

  <script type="module">
    import {
      setRequiresToForm,
      observerValidationErrors,
      validateFormData,
      setValidationErrorsToForm,
      clearFormValidationErrors
    } from '@vardario/zod-form-validation';
    import { z } from 'zod';
    const form = document.querySelector('form');
    const inputs = form.querySelectorAll('input,select,textarea,fieldset');

    inputs.forEach(input => {
      observerValidationErrors(input, errors => {
        const errorMessages = input.parentElement.nextElementSibling;

        errorMessages &&
          errorMessages.replaceChildren(
            ...errors.map(error => {
              const span = document.createElement('span');
              span.innerText = error;
              span.className = 'text-sm text-red-600';
              return span;
            })
          );
      });
    });

    const petsSchema = z.enum(['dog', 'cat', 'hamster', 'parrot', 'spider', 'goldfish']);

    const monsterSchema = z.enum(['kraken', 'sasquatch', 'mothman']);
    const fruits = z.enum(['apple', 'banana', 'kiwi']);

    const schema = z.object({
      admin: z.boolean().optional(),
      birthday: z.string().optional(),
      givenName: z.string().min(1),
      surname: z.string().min(1),
      contact: z.object({
        tel: z.string(),
        email: z
          .object({
            email: z.string().email(),
            confirmEmail: z.string().email()
          })
          .superRefine(({ email, confirmEmail }, context) => {
            if (email !== confirmEmail) {
              context.addIssue({
                code: z.ZodIssueCode.custom,
                message: 'E-Mail does not match',
                path: ['confirmEmail']
              });
            }
          })
      }),
      amount: z.number(),
      range: z.number(),
      pet: petsSchema,
      fruits: z.array(fruits),
      description: z.string(),
      monster: monsterSchema
    });

    function fromValidation() {
      const result = validateFormData(new FormData(form), schema);
      if (result.success === false) {
        setValidationErrorsToForm(form, result.error);
        return false;
      }

      return true;
    }

    let doValidateOnInput = false;
    setRequiresToForm(form, schema);
    clearFormValidationErrors(form);

    form.addEventListener('submit', event => {
      doValidateOnInput = true;
      if (!fromValidation()) {
        event.preventDefault();
        event.stopImmediatePropagation();
      }
    });

    form.addEventListener('input', event => {
      doValidateOnInput && fromValidation();
    });
  </script>
</html>
